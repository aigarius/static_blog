<html><body><p></p><p>Got access to a new, more powerful server, moved my blog from Mnemosyne to Wordpress, hopefully did not flood p.d.o, did not move the comments over yet.</p>
<p></p><p>And not to flood the planet.d.o with the move I did this little change to the Wordpress feed - at the very end of the wp-atom.php file there is this line:</p>
<p><code><br>&lt;?php $items_count++; if (($items_count == get_settings('posts_per_rss')) &amp;&amp; empty ...<br></code></p>
<p></p><p>So I changed it to this:</p>
<p><code><br>&lt;?php $items_count++; if ((($items_count == get_settings('posts_per_rss')) || $post-&gt;post_date &lt; 1150758000 ) &amp;&amp; empty ...<br></code></p>
<p></p><p>Where 1150758000 is the UNIX time of some point between the last post from the old blog and the first post in the new blog.</p>
<p></p><p>And I also imported my old posts entries from an Atom feed using the rss feed import as a base. The diff is after the break</p>
<p><!--more--></p>
<p></p><code><br>--- rss.php     2005-12-28 22:24:12.000000000 +0200<br>+++ atom.php    2006-06-18 18:26:03.000000000 +0300<br>@@ -1,13 +1,13 @@<br> &lt; ?php</code>
<p>-class RSS_Import {<br>+class Atom_Import {</p>
<p>        var $posts = array ();<br>        var $file;</p>
<p>        function header() {<br>                echo '&lt;div class="wrap"&gt;';<br>-               echo '&lt;h2&gt;'.__('Import RSS').'&lt;/h2&gt;';<br>+               echo '&lt;h2&gt;'.__('Import Atom').'&lt;/h2&gt;';<br>        }</p>
<p>        function footer() {<br>@@ -21,8 +21,8 @@<br>        }</p>
<p>        function greet() {<br>-               echo '&lt;p&gt;'.__('Howdy! This importer allows you to extract posts from any RSS 2.0 file into your blog. This is useful if you want to import your posts from a system that is not handled by a custom import tool. Pick an RSS file to upload and click Import.').'&lt;/p&gt;';<br>-               wp_import_upload_form("admin.php?import=rss&amp;step=1");<br>+               echo '&lt;p&gt;'.__('Howdy! This importer allows you to extract posts from any ATOM 1.0 file into your blog. This is useful if you want to import your posts from a system that is not handled by a custom import tool. Pick an Atom file to upload and click Import.').'&lt;/p&gt;';<br>+               wp_import_upload_form("admin.php?import=atom&amp;step=1");<br>        }</p>
<p>        function get_posts() {<br>@@ -33,14 +33,14 @@<br>                $importdata = implode('', $datalines); // squish it<br>                $importdata = str_replace(array ("\r\n", "\r"), "\n", $importdata);</p>
<p>-               preg_match_all('|&lt;item&gt;(.*?)&lt;/item&gt;|is', $importdata, $this-&gt;posts);<br>+               preg_match_all('|&lt;entry&gt;(.*?)&lt;/entry&gt;|is', $importdata, $this-&gt;posts);<br>                $this-&gt;posts = $this-&gt;posts[1];<br>                $index = 0;<br>                foreach ($this-&gt;posts as $post) {<br>-                       preg_match('|&lt;title&gt;(.*?)&lt;/title&gt;|is', $post, $post_title);<br>+                       preg_match('|&lt;title [^&gt;]*&gt;(.*?)&lt;/title&gt;|is', $post, $post_title);<br>                        $post_title = $wpdb-&gt;escape(trim($post_title[1]));</p>
<p>-                       preg_match('|&lt;pubdate&gt;(.*?)&lt;/pubdate&gt;|is', $post, $post_date);<br>+                       preg_match('|&lt;published&gt;(.*?)&lt;/published&gt;|is', $post, $post_date);</p>
<p>                        if ($post_date) {<br>                                $post_date = strtotime($post_date[1]);<br>@@ -68,13 +68,13 @@<br>                                $cat_index++;<br>                        }</p>
<p>-                       preg_match('|&lt;guid .+?&gt;(.*?)&lt;/guid&gt;|is', $post, $guid);<br>+                       preg_match('|&lt;id&gt;(.*?)&lt;/id&gt;|is', $post, $guid);<br>                        if ($guid)<br>                                $guid = $wpdb-&gt;escape(trim($guid[1]));<br>                        else<br>                                $guid = '';</p>
<p>-                       preg_match('|&lt;content :encoded&gt;(.*?)&lt;/content&gt;|is', $post, $post_content);<br>+                       preg_match('|&lt;content [^&gt;]*?&gt;.*?&lt;div .*?&gt;(.*?)&lt;/div&gt;\s*?&lt;/content&gt;|is', $post, $post_content);<br>                        $post_content = str_replace(array ('&lt; ![CDATA[', ']]&gt;'), '', $wpdb-&gt;escape(trim($post_content[1])));</p>
<p>                        if (!$post_content) {<br>@@ -85,6 +85,7 @@</p>
<p>                        // Clean up content<br>                        $post_content = preg_replace('|&lt; (/?[A-Z]+)|e', "'&lt;' . strtolower('$1')", $post_content);<br>+                       $post_content = str_replace('\n', ' ', $post_content);<br>                        $post_content = str_replace('&lt;br&gt;', '&lt;br /&gt;', $post_content);<br>                        $post_content = str_replace('&lt;hr /&gt;', '&lt;hr /&gt;', $post_content);</p>
<p>@@ -160,12 +161,12 @@<br>                $this-&gt;footer();<br>        }</p>
<p>-       function RSS_Import() {<br>+       function Atom_Import() {<br>                // Nothing.<br>        }<br> }</p>
<p>-$rss_import = new RSS_Import();<br>+$atom_import = new Atom_Import();</p>
<p>-register_importer('rss', 'RSS', __('Import posts from an RSS feed'), array ($rss_import, 'dispatch'));<br>+register_importer('atom', 'Atom', __('Import posts from an Atom feed'), array ($atom_import, 'dispatch'));<br> ?&gt;<br></p></body></html>